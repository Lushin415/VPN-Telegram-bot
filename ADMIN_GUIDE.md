# Инструкция для администратора VPN Telegram Bot

## Основные задачи администратора
- Управление пользователями, подписками, ключами и серверами
- Мониторинг состояния серверов и платежей
- Резервное копирование и восстановление базы данных
- Получение уведомлений о сбоях и ошибках

## Админ-команды (отправлять только с Telegram ID, указанного в `ADMIN_TELEGRAM_ID`)
- `/admin_stats` — статистика пользователей, подписок, оплат
- `/admin_keys` — список всех ключей (фильтрация: активные, свободные)
- `/admin_logs` — последние логи действий
- `/admin_servers` — список серверов, их статусы
- `/admin_reload` — ручная перезагрузка конфигов серверов
- `/admin_payments` — выгрузка платежей за период
- `/admin_broadcast` — массовая рассылка сообщения всем пользователям
- `/admin_user <id>` — информация о пользователе
- `/admin_key <id>` — информация о ключе
- `/admin_release <id>` — ручное освобождение ключа
- `/admin_backup` — создать резервную копию БД и получить файл
- `/admin_restore <имя_файла>` — восстановить БД из бэкапа
- `/admin_addserver <Name> <IP> <Price1> <Price3> <Price6> <Price12> <is_active(0/1)>` — добавить новый сервер

## Автоматизация
- Автобэкап БД ежедневно, хранение 1 месяц (папка `backups/`)
- Оповещения админу о сбоях серверов, ошибках оплаты, ошибках webhook и резервного копирования
- Отключение просроченных ключей и уведомление пользователя ежедневно
- Автоматические напоминания пользователям за 3 дня до окончания подписки

## Как добавить сервер
1. Используйте команду `/admin_addserver` или добавьте запись напрямую в таблицу `servers` (через pgAdmin/psql).
2. После добавления сервер сразу доступен для выбора пользователями.

## Восстановление и резервное копирование
- Все бэкапы в папке `backups/`
- Хранение бэкапов — 1 месяц, автоматическая очистка
- Для восстановления используйте `/admin_restore <имя_файла>`

## Безопасность
- Только Telegram ID из переменной окружения `ADMIN_TELEGRAM_ID` обладает правами администратора
- Все действия админа логируются
- Критические ошибки и сбои дублируются админу

---

Рекомендуется регулярно проверять состояние серверов и делать резервные копии базы данных!
